<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Simple Browser FPS</title>
<style>
  body { margin:0; overflow:hidden; }
  canvas { display:block; width:100vw; height:100vh; background:#87ceeb; }
  .crosshair {
    position:absolute;
    top:50%; left:50%;
    width:10px; height:10px;
    margin-left:-5px; margin-top:-5px;
    border:2px solid black;
    border-radius:50%;
    pointer-events:none;
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div class="crosshair"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/examples/js/controls/PointerLockControls.js"></script>
<script>
// ======= Three.js Setup =======
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({canvas: document.getElementById('gameCanvas')});
renderer.setSize(window.innerWidth, window.innerHeight);

// ===== Lighting =====
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(5,10,7);
scene.add(light);
scene.add(new THREE.AmbientLight(0x404040));

// ===== Ground =====
const groundGeo = new THREE.BoxGeometry(100,1,100);
const groundMat = new THREE.MeshPhongMaterial({color:0x228B22});
const ground = new THREE.Mesh(groundGeo, groundMat);
ground.position.y = -0.5;
scene.add(ground);

// ===== Controls =====
const controls = new THREE.PointerLockControls(camera, document.body);
document.body.addEventListener('click',()=>controls.lock(), false);
camera.position.y = 1.6;

let moveForward=false, moveBackward=false, moveLeft=false, moveRight=false;
const velocity = new THREE.Vector3();
const direction = new THREE.Vector3();
const speed = 5;

document.addEventListener('keydown', (e)=>{
  if(e.code==='KeyW') moveForward=true;
  if(e.code==='KeyS') moveBackward=true;
  if(e.code==='KeyA') moveLeft=true;
  if(e.code==='KeyD') moveRight=true;
});
document.addEventListener('keyup', (e)=>{
  if(e.code==='KeyW') moveForward=false;
  if(e.code==='KeyS') moveBackward=false;
  if(e.code==='KeyA') moveLeft=false;
  if(e.code==='KeyD') moveRight=false;
});

// ===== Gun =====
const gunGeo = new THREE.BoxGeometry(0.2,0.2,1);
const gunMat = new THREE.MeshPhongMaterial({color:0x555555});
const gun = new THREE.Mesh(gunGeo, gunMat);
gun.position.set(0,-0.2,-0.5);
camera.add(gun);

// ===== Enemies =====
const enemies = [];
const enemyGeo = new THREE.BoxGeometry(1,1,1);
const enemyMat = new THREE.MeshPhongMaterial({color:0xff0000});
for(let i=0;i<5;i++){
  const enemy = new THREE.Mesh(enemyGeo, enemyMat);
  enemy.position.set(Math.random()*20-10,0.5,Math.random()*20-10);
  scene.add(enemy);
  enemies.push(enemy);
}

// ===== Shooting =====
document.addEventListener('mousedown', shoot);
function shoot(){
  const raycaster = new THREE.Raycaster();
  raycaster.setFromCamera(new THREE.Vector2(0,0), camera);
  const intersects = raycaster.intersectObjects(enemies);
  intersects.forEach((enemy)=>{
    scene.remove(enemy);
    enemies.splice(enemies.indexOf(enemy),1);
  });
}

// ===== Animation Loop =====
const clock = new THREE.Clock();
function animate(){
  requestAnimationFrame(animate);
  const delta = clock.getDelta();
  velocity.x -= velocity.x*10.0*delta;
  velocity.z -= velocity.z*10.0*delta;
  direction.z = Number(moveForward)-Number(moveBackward);
  direction.x = Number(moveRight)-Number(moveLeft);
  direction.normalize();
  if(moveForward||moveBackward) velocity.z -= direction.z*speed*delta;
  if(moveLeft||moveRight) velocity.x -= direction.x*speed*delta;
  controls.moveRight(-velocity.x);
  controls.moveForward(-velocity.z);

  // Enemy follow player
  enemies.forEach(enemy=>{
    const dir = new THREE.Vector3().subVectors(camera.position, enemy.position);
    dir.y=0; dir.normalize();
    enemy.position.add(dir.multiplyScalar(1*delta));
  });

  renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>
